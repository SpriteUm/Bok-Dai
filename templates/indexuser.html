<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô - ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤</title>
    <link
      href="{{ url_for('static', filename='dist/output.css') }}"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body class="bg-custom-green-lightest min-h-screen font-kanit">
    <header class="bg-[#5C7F5C] shadow-xl">
      <nav
        class="container mx-auto px-4 py-4 flex justify-between items-center"
      >
        <div class="text-xl font-bold text-white">
          {% if current_user.is_authenticated %}
          <span class="text-white font-medium"
            >‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, {{ current_user.username }}</span
          >
        </div>
        <div>
          <a
            href="{{ url_for('report.report') }}"
            class="inline-block border bg-white hover:bg-gray-300 transition duration-300 px-4 py-1 mx-1 rounded-full text-sm font-medium"
            >‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏´‡∏°‡πà</a
          >
          <a
            href="{{ url_for('auth.logout') }}"
            class="inline-block border bg-white hover:bg-gray-300 transition duration-300 px-4 py-1 mx-1 rounded-full text-sm font-medium"
            >‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a
          >
        </div>
      </nav>
    </header>

    <main class="container mx-auto p-8">
      <!-- Summary Section -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div
          class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-red-500"
        >
          <p class="text-black text-sm">‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</p>
          <p id="pending-count" class="text-3xl font-bold mt-1 text-red-500">
            0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
          </p>
        </div>
        <div
          class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-yellow-500"
        >
          <p class="text-black text-sm">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
          <p
            id="inprogress-count"
            class="text-3xl font-bold mt-1 text-yellow-500"
          >
            0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
          </p>
        </div>
        <div
          class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-green-500"
        >
          <p class="text-black text-sm">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß</p>
          <p id="resolved-count" class="text-3xl font-bold mt-1 text-green-500">
            0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
          </p>
        </div>
      </div>

      <hr class="border-custom-green-medium mb-8" />

      <h2 class="text-3xl font-bold mb-4 text-custom-green-dark">
        ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
      </h2>

      <!-- Table Header -->
      <div
        class="flex justify-between items-center mb-3 p-4 bg-custom-green-dull-green rounded-t-lg"
      >
        <p class="text-custom-green-darkest w-1/4">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</p>
        <p class="text-custom-green-darkest w-1/2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</p>
        <p class="text-custom-green-darkest w-1/6 text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</p>
        <p class="text-custom-green-darkest w-1/6 text-center">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô</p>
        <p class="text-custom-green-darkest w-1/6 text-center">‡∏î‡∏π</p>
      </div>

      <!-- Issue List -->
      <div id="issue-list"></div>

      <div class="mt-8 text-center">
        <a
          href="/my-issues"
          class="text-[#1B5E20] hover:text-green-darkest text-sm"
          >‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</a
        >
      </div>
    </main>

    <!-- Script to fetch and render issues -->
    <script>
      fetch("/api/issues")
        .then((res) => res.json())
        .then((data) => {
          const summary = data.summary;
          const issues = data.my_issues;

          // Summary counts
          document.getElementById(
            "pending-count"
          ).textContent = `${summary.pending} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
          document.getElementById(
            "inprogress-count"
          ).textContent = `${summary.in_progress} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
          document.getElementById(
            "resolved-count"
          ).textContent = `${summary.resolved} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;

          // Issue list
          const listContainer = document.getElementById("issue-list");
          listContainer.innerHTML = "";
          issues.forEach((issue) => {
            const urgencyIcon =
              issue.urgency === "red"
                ? '<span class="text-red-600">üî¥</span>'
                : issue.urgency === "orange"
                ? '<span class="text-orange-500">üü†</span>'
                : issue.urgency === "green"
                ? '<span class="text-green-500">üü¢</span>'
                : '<span class="text-gray-500">‚ö™Ô∏è</span>';

            const statusClass =
              issue.status === "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß"
                ? "bg-green-100 text-green-800"
                : issue.status === "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£"
                ? "bg-yellow-100 text-yellow-800"
                : "bg-red-100 text-red-800";

            listContainer.innerHTML += `
              <div class="flex justify-between items-center p-4 bg-white border-b hover:bg-gray-50 transition duration-150">
                <p class="w-1/4">${issue.category}</p>
                <p class="w-1/2 truncate">${issue.detail}</p>
                <p class="w-1/6 text-center">
                  <span class="inline-block ${statusClass} text-xs px-2.5 py-0.5 rounded-full">${issue.status}</span>
                </p>
                <p class="w-1/6 text-center text-2xl">${urgencyIcon}</p>
                <a href="/issue/${issue.id}" class="w-1/6 text-center text-green-700 hover:text-green-900">${issue.view}</a>
              </div>
            `;
          });
        })
        .catch((err) => {
          console.error("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", err);
        });
    </script>
  </body>
</html>
