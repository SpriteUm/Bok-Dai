<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤</title>
  <link href="{{ url_for('static', filename='dist/output.css') }}" rel="stylesheet" />
</head>
<body class="font-kanit bg-custom-green-lightest min-h-screen">
  <header class="bg-[#5C7F5C] text-white shadow-md">
    <div class="container mx-auto px-4 py-4">
      <h1 class="text-xl font-bold">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤ #{{ issue.id }}</h1>
    </div>
  </header>

  <main class="container mx-auto p-8">
    <div class="bg-white p-6 rounded-xl shadow-lg border-l-8 border-custom-green-dark">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <p class="text-sm text-gray-600">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</p>
          <p class="text-lg font-semibold text-custom-green-dark">{{ issue.category }}</p>
        </div>
        <div>
          <p class="text-sm text-gray-600">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</p>
          {% if issue.status == '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß' %}
            <span class="inline-block bg-green-100 text-green-800 text-sm px-3 py-1 rounded-full">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß</span>
          {% elif issue.status == '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' %}
            <span class="inline-block bg-yellow-100 text-yellow-800 text-sm px-3 py-1 rounded-full">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>
          {% else %}
            <span class="inline-block bg-red-100 text-red-800 text-sm px-3 py-1 rounded-full">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>
          {% endif %}
        </div>
        <div>
          <p class="text-sm text-gray-600">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô</p>
          <p class="text-2xl">
            {% if issue.urgency == 'üî¥' %}üî¥{% elif issue.urgency == 'üü†' %}üü†{% elif issue.urgency == 'üü¢' %}üü¢{% else %}-{% endif %}
          </p>
        </div>
        <div>
          <p class="text-sm text-gray-600">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</p>
          <p class="text-custom-green-dark text-sm">
            {% if issue.date_reported %}
              {{ issue.date_reported.strftime('%d/%m/%Y') }}
            {% else %}
              -
            {% endif %}
          </p>
        </div>
      </div>

      <hr class="my-6 border-custom-green-medium" />

      <div>
        <p class="text-sm text-gray-600 mb-1">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</p>
        <div class="bg-gray-100 p-4 rounded text-custom-green-dark text-sm whitespace-pre-line">
          {{ issue.detail }}
        </div>
      </div>

      {% if images %}
        <div class="mt-6">
          <p class="text-sm text-gray-600 mb-1">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏ö</p>

          <!-- ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô grid responsive ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ thumbnail ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà; ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏π‡∏õ‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î modal -->
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for src in images %}
              <a href="{{ src }}" data-full-src="{{ src }}" class="block group">
                <img src="{{ src }}" alt="image"
                     class="w-full h-64 md:h-80 lg:h-96 object-cover rounded border transition-transform transform group-hover:scale-105 cursor-pointer" />
              </a>
            {% endfor %}
          </div>
        </div>
      {% endif %}

      {% if issue.location_link %}
        <div class="mt-6">
          <p class="text-sm text-gray-600 mb-1">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á</p>
          <a href="{{ issue.location_link }}" target="_blank"
             class="text-green-700 underline text-sm break-all">
            ‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏ô Google Maps
          </a>
        </div>
      {% endif %}

      <div class="mt-8">
        <a href="{{ url_for('indexuser.indexuser') }}"
           class="inline-block bg-white border border-custom-green-dark text-custom-green-dark px-4 py-2 rounded hover:bg-custom-green-light text-sm">
          ‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
        </a>
      </div>
    </div>
  </main>

  <!-- Modal ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏†‡∏≤‡∏û -->
  <div id="image-modal" class="fixed inset-0 hidden items-center justify-center bg-black bg-opacity-70 z-50">
    <div class="relative w-full max-w-6xl mx-4">
      <button id="image-modal-close" class="absolute right-2 top-2 text-white text-3xl leading-none">&times;</button>
      <img id="image-modal-img" src="" alt="‡∏Ç‡∏¢‡∏≤‡∏¢‡∏£‡∏π‡∏õ" class="w-full h-auto max-h-[90vh] object-contain rounded-md shadow-lg" />
    </div>
  </div>

  <script>
    // ‡πÄ‡∏õ‡∏¥‡∏î modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏£‡∏π‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ data-full-src
    document.addEventListener('click', function (e) {
      const el = e.target.closest('a[data-full-src], img');
      if (!el) return;
      const link = el.closest('a[data-full-src]') || el.closest('a') || el;
      const src = link.getAttribute('data-full-src') || link.getAttribute('href') || link.getAttribute('src');
      if (!src) return;
      // ‡∏ñ‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ö‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏°‡∏µ data-full-src ‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏Ç‡∏±‡∏î‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞ (‡∏Ç‡∏≠‡πÉ‡∏´‡πâ data-full-src ‡∏°‡∏µ‡∏ó‡∏∏‡∏Å‡∏†‡∏≤‡∏û)
      if (!link.hasAttribute('data-full-src')) return;
      e.preventDefault();
      const modal = document.getElementById('image-modal');
      const modalImg = document.getElementById('image-modal-img');
      modalImg.src = src;
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    });

    // ‡∏õ‡∏¥‡∏î modal
    document.getElementById('image-modal-close').addEventListener('click', function () {
      const modal = document.getElementById('image-modal');
      modal.classList.add('hidden');
      modal.classList.remove('flex');
      document.getElementById('image-modal-img').src = '';
    });
    document.getElementById('image-modal').addEventListener('click', function (e) {
      if (e.target === this) {
        this.classList.add('hidden');
        this.classList.remove('flex');
        document.getElementById('image-modal-img').src = '';
      }
    });
  </script>
</body>
</html>
